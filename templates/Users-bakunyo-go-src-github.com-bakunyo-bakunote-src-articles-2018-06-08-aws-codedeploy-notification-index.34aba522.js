(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{93:function(e,a,t){"use strict";t.r(a);var n=t(0),o=t.n(n),c=t(22),l=t.n(c),s=t(62),p=t.n(s),m=t(193),r={},i="wrapper";function u(e){var a=e.components,t=p()(e,["components"]);return Object(m.a)(i,l()({},r,t,{components:a,mdxType:"MDXLayout"}),Object(m.a)("p",null,"久々に書きます。\n近頃、個人開発にてAWS CodeDeployを使っていて、デプロイ時に通知を受け取りたいなぁと思ったので設定してみました。"),Object(m.a)("h3",null,"やったこと"),Object(m.a)("ol",null,Object(m.a)("li",{parentName:"ol"},"Amazon SNS トピックの作成"),Object(m.a)("li",{parentName:"ol"},"デプロイグループがSNSトピックを発行するためのアクセス権限"),Object(m.a)("li",{parentName:"ol"},"デプロイグループのトリガー設定")),Object(m.a)("p",null,"の３つです。"),Object(m.a)("h2",null,"Amazon SNS トピックの作成"),Object(m.a)("h3",null,"Amazon SNS（Simple Notification Service） とは"),Object(m.a)("blockquote",null,Object(m.a)("p",{parentName:"blockquote"},"サブスクライブしているエンドポイントまたはクライアントへのメッセージの配信または送信を調整し、管理するウェブサービスです。Amazon SNS には、発行者とサブスクライバーという 2 種類のクライアントが存在し、それぞれ生産者と消費者とも呼ばれます。",Object(m.a)("br",{parentName:"p"}),"\n","-- ",Object(m.a)("a",l()({parentName:"p"},{href:"https://docs.aws.amazon.com/ja_jp/sns/latest/dg/welcome.html"}),"Amazon SNSとは"))),Object(m.a)("p",null,"今回は、CodeDeployのデプロイグループが生産者、通知を受けたアクション(email)が消費者ということになりそうです。"),Object(m.a)("h3",null,"トピックの作成"),Object(m.a)("p",null,"SNSコンソールから新しいトピックを作成します\n",Object(m.a)("img",l()({parentName:"p"},{src:"https://bakunote-images.s3-ap-northeast-1.amazonaws.com/storage/2018/06/08/1.png",alt:"new-topic"}))),Object(m.a)("h3",null,"サブスクリプションの登録"),Object(m.a)("p",null,"作成したトピックを選択して、「トピックへのサブスクリプション」\nEmailを選択します。\n登録したメールアドレスに、承認メールが届きます。"),Object(m.a)("h2",null,"デプロイグループがSNSトピックを発行するためのアクセス権限付与"),Object(m.a)("p",null,"IAMコンソール→ロール→CodeDeployで使用しているロールを選択\nSNS publish用のポリシーを作成・アタッチします。\n以下のドキュメント通りです。\n",Object(m.a)("a",l()({parentName:"p"},{href:"https://docs.aws.amazon.com/ja_jp/codedeploy/latest/userguide/monitoring-sns-event-notifications-permisssions.html?icmpid=docs_acd_console_triggers"}),"https://docs.aws.amazon.com/ja_jp/codedeploy/latest/userguide/monitoring-sns-event-notifications-permisssions.html?icmpid=docs_acd_console_triggers")),Object(m.a)("h2",null,"デプロイグループのトリガー設定"),Object(m.a)("p",null,"デプロイグループの編集で詳細設定→トリガーの作成を選択します。\n",Object(m.a)("img",l()({parentName:"p"},{src:"https://bakunote-images.s3-ap-northeast-1.amazonaws.com/storage/2018/06/08/2.png",alt:"create-trigger"})),"\n",Object(m.a)("img",l()({parentName:"p"},{src:"https://bakunote-images.s3-ap-northeast-1.amazonaws.com/storage/2018/06/08/3.png",alt:"create-trigger"}))),Object(m.a)("p",null,"デプロイ時に無事にメールが届きました！"))}u.isMDXComponent=!0;var b=t(194);a.default=function(){return o.a.createElement(b.a,null,o.a.createElement(u,null))}}}]);